"""
抖音直播敏感词过滤模块
用于在朗读新闻时规避抖音敏感词
"""

# 敏感词映射表：原词 -> 替换词
DOUYIN_SENSITIVE_WORDS = {
    # ===== 国家领导人名称 =====
    "习近平": "领导",
    "李克强": "领导",
    "李强": "领导",
    "王沪宁": "领导",
    "赵乐际": "领导",
    "韩正": "领导",
    "丁薛祥": "领导",
    "蔡奇": "领导",
    "拜登": "美国领导人",
    "特朗普": "美国领导人",
    "川普": "美国领导人",
    "普京": "俄罗斯领导人",
    "泽连斯基": "乌克兰领导人",
    "岸田文雄": "日本领导人",
    "马克龙": "法国领导人",
    "苏纳克": "英国领导人",
    "默克尔": "德国领导人",
    "金正恩": "朝鲜领导人",
    
    # ===== 抖音竞争对手-其他平台 =====
    "快手": "短视频平台",
    "小红书": "社交平台",
    "B站": "视频平台",
    "哔哩哔哩": "视频平台",
    "微博": "社交平台",
    "微信": "社交软件",
    "视频号": "短视频功能",
    "拼多多": "电商平台",
    "淘宝": "电商平台",
    "天猫": "电商平台",
    "京东": "电商平台",
    
    # ===== 股票公司名称 =====
    "贵州茅台": "白酒龙头",
    "茅台": "白酒企业",
    "宁德时代": "新能源龙头",
    "比亚迪": "新能源汽车",
    "腾讯": "科技公司",
    "腾讯控股": "科技公司",
    "阿里巴巴": "电商公司",
    "阿里": "电商公司",
    "美团": "互联网公司",
    "京东集团": "电商公司",
    "拼多多": "电商公司",
    "字节跳动": "互联网公司",
    "抖音": "短视频平台",
    "今日头条": "资讯平台",
    "小米": "科技公司",
    "华为": "科技公司",
    "苹果": "科技公司",
    "Apple": "科技公司",
    "特斯拉": "电动汽车公司",
    "Tesla": "电动汽车公司",
    "英伟达": "芯片公司",
    "NVIDIA": "芯片公司",
    "微软": "科技公司",
    "Microsoft": "科技公司",
    "谷歌": "科技公司",
    "Google": "科技公司",
    "百度": "科技公司",
    "网易": "互联网公司",
    "滴滴": "出行平台",
    "携程": "旅游平台",
    "知乎": "知识社区",
    "Baidu": "科技公司",
    "中石油": "能源公司",
    "中石化": "能源公司",
    "中国平安": "保险公司",
    "平安银行": "银行",
    "招商银行": "银行",
    "工商银行": "银行",
    "建设银行": "银行",
    "农业银行": "银行",
    "中国银行": "银行",
    
    # ===== 金融投资敏感词 =====
    "涨停": "涨幅上限",
    "跌停": "跌幅下限",
    "暴涨": "大幅上涨",
    "暴跌": "大幅下跌",
    "涨停板": "涨幅限制",
    "跌停板": "跌幅限制",
    "牛市": "上涨行情",
    "熊市": "下跌行情",
    "疯牛": "快速上涨行情",
    "杀跌": "恐慌抛售",
    "追涨": "跟进买入",
    "抄底": "低位买入",
    "逃顶": "高位卖出",
    "割肉": "止损卖出",
    "爆仓": "强制平仓",
    "穿仓": "账户亏损",
    "杠杆": "资金放大",
    "配资": "融资",
    "非法集资": "违规集资",
    "非法集资": "违规集资",
    
    # ===== 夸大宣传类 =====
    "必涨": "有望上涨",
    "必跌": "可能下跌",
    "稳赚": "预期收益",
    "暴利": "高收益",
    "翻倍": "大幅增长",
    "暴涨": "大涨",
    "暴跌": "大跌",
    "暴富": "致富",
    "躺赚": "稳健收益",
    "日赚": "每日收益",
    "包赚": "预期盈利",
    "百分百": "大概率",
    "百分之百": "大概率",
    "绝对": "预计",
    "一定": "有望",
    "保证": "预期",
    "承诺": "预期",
    
    # ===== 引导交易类 =====
    "加微信": "联系客服",
    "加我微信": "联系客服",
    "加群": "加入社群",
    "私聊": "私信",
    "扫码": "识别二维码",
    "点击链接": "查看详情",
    "领红包": "领取奖励",
    "领福利": "获取优惠",
    
    # ===== 赌博相关 =====
    "赌": "博弈",
    "赌博": "博弈",
    "下注": "投入",
    "押注": "看好",
    "押宝": "投资",
    "博彩": "彩票",
    
    # ===== 政治敏感 =====
    "法轮功": "**",
    "台独": "**",
    "藏独": "**",
    "疆独": "**",
    
    # ===== 其他敏感词 =====
    "傻X": "不明智",
    "傻叉": "不明智",
    "SB": "不理智",
    "傻B": "不理智",
    "MD": "哎呀",
    "TMD": "哎呀",
    "TNND": "哎呀",
    "卧槽": "天哪",
    "我靠": "天哪",
    "我去": "哎呀",
    "坑爹": "坑人",
    "坑人": "不靠谱",
    "扯淡": "不靠谱",
    "扯蛋": "不靠谱",
    "放屁": "不对",
    "胡说": "不准确",
    "瞎说": "不准确",
    
    # ===== 财经媒体名称规避 =====
    "财联社": "快讯",
    
    # ===== 风险提示词替换 =====
    "风险巨大": "风险较大",
    "风险极大": "风险较大",
    "血本无归": "可能亏损",
    "倾家荡产": "严重亏损",
    "家破人亡": "严重损失",
}

# 需要完全删除的词（不替换）
DOUYIN_BLOCKED_WORDS = [
    "法轮功",
    "法轮大法",
    "台独分子",
    "藏独分子", 
    "疆独分子",
]


def filter_text_for_douyin(text: str) -> str:
    """
    过滤抖音敏感词
    
    Args:
        text: 原始文本
        
    Returns:
        过滤后的文本
    """
    if not text:
        return text
    
    result = text
    
    # 先删除完全屏蔽的词
    for word in DOUYIN_BLOCKED_WORDS:
        result = result.replace(word, "")
    
    # 再进行敏感词替换
    for original, replacement in DOUYIN_SENSITIVE_WORDS.items():
        result = result.replace(original, replacement)
    
    return result


def get_replacement_table() -> list:
    """
    获取敏感词映射表（用于展示）
    
    Returns:
        映射表列表
    """
    table = []
    for original, replacement in DOUYIN_SENSITIVE_WORDS.items():
        table.append({
            "原词": original,
            "替换词": replacement,
            "类型": _get_word_category(original)
        })
    return table


def _get_word_category(word: str) -> str:
    """获取敏感词类型"""
    # 国家领导人
    leader_words = ["习近平", "李克强", "李强", "拜登", "特朗普", "普京", "泽连斯基", 
                    "岸田文雄", "马克龙", "金正恩", "默克尔", "苏纳克"]
    # 竞品平台
    platform_words = ["快手", "小红书", "B站", "哔哩哔哩", "微博", "微信", "视频号",
                      "拼多多", "淘宝", "天猫", "京东"]
    # 公司股票
    company_words = ["茅台", "宁德时代", "比亚迪", "腾讯", "阿里巴巴", "阿里", "美团",
                     "字节跳动", "抖音", "今日头条", "小米", "华为", "苹果", "Apple",
                     "特斯拉", "Tesla", "英伟达", "NVIDIA", "微软", "Microsoft", "谷歌", 
                     "Google", "百度", "网易", "滴滴", "携程", "知乎", "中石油", "中石化",
                     "平安", "招商银行", "工商银行", "建设银行", "农业银行", "中国银行"]
    # 金融投资
    finance_words = ["涨停", "跌停", "暴涨", "暴跌", "牛市", "熊市", "杠杆", "配资", 
                     "抄底", "逃顶", "割肉", "爆仓", "追涨", "杀跌"]
    # 夸大宣传
    exaggerate_words = ["必涨", "必跌", "稳赚", "暴利", "翻倍", "暴富", "躺赚", 
                        "百分百", "百分之百", "绝对", "一定", "保证", "承诺"]
    # 引导交易
    guide_words = ["加微信", "加群", "私聊", "扫码", "点击链接", "领红包", "领福利"]
    # 赌博相关
    gamble_words = ["赌", "赌博", "下注", "押注", "押宝", "博彩"]
    
    for w in leader_words:
        if w in word:
            return "国家领导"
    for w in platform_words:
        if w in word:
            return "竞品平台"
    for w in company_words:
        if w in word:
            return "公司名称"
    for w in finance_words:
        if w in word:
            return "金融投资"
    for w in exaggerate_words:
        if w in word:
            return "夸大宣传"
    for w in guide_words:
        if w in word:
            return "引导交易"
    for w in gamble_words:
        if w in word:
            return "赌博相关"
    return "其他"


if __name__ == "__main__":
    # 测试
    test_text = "今日股市暴涨，财联社报道，这只股票必涨，建议加微信领取福利！"
    filtered = filter_text_for_douyin(test_text)
    print(f"原文: {test_text}")
    print(f"过滤后: {filtered}")
    print("\n敏感词映射表:")
    for item in get_replacement_table()[:10]:
        print(f"  {item['原词']} -> {item['替换词']} ({item['类型']})")
